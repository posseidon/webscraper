<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title th:text="${quiz.title}">Quiz Start</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'quiz-yellow': '#fce883',
                        'quiz-yellow-light': '#ffec8b'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    },
                    boxShadow: {
                        'paper': '0.5rem 0.5rem 0 black',
                        'paper-hover': '0.8rem 0.8rem 0 black',
                        'paper-sm': '0.25rem 0.25rem 0 black'
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" th:href="@{/css/quiz-start-tailwind.css}">
</head>
<body class="min-h-screen bg-quiz-yellow font-inter p-4 flex justify-center items-start overflow-x-hidden touch-manipulation">
<div class="bg-white w-full max-w-lg text-center my-2 rounded-2xl border-4 border-black shadow-paper">
    <!-- Quiz Title Bubble -->
    <div class="relative bg-white inline-block px-5 py-3 text-center rounded-3xl border-4 border-black shadow-paper transform -translate-x-1 -translate-y-1 transition-transform duration-200 mb-5 mt-6">
        <h1 class="text-2xl md:text-3xl m-0 text-gray-800 font-bold leading-tight" th:text="${quiz.title}">QUIZ</h1>
    </div>

    <div class="px-5 pb-8" id="quiz-configuration-container">
        <!-- Topics Section -->
        <div class="mb-8">
            <div class="topics-toggle cursor-pointer select-none flex items-center justify-center w-4/5 mx-auto mb-4 px-4 py-2 bg-white border-4 border-black rounded-full shadow-paper-sm font-bold text-lg" onclick="toggleTopics()">
                Topics Covered 
                <span class="toggle-icon ml-2 text-xl font-bold leading-none transition-transform duration-200">â–¶</span>
            </div>
            <div class="topics-container flex flex-wrap justify-center gap-3 mb-5" id="topicsContainer">
                <div th:each="topic : ${quiz.topics}" class="topic-bubble card-base flex-1 max-w-[48%] md:max-w-[30%] lg:max-w-[30%] px-5 py-3 text-center cursor-pointer select-none min-h-[44px] bg-white rounded-3xl border-4 border-black shadow-paper transition-all duration-200 hover:transform hover:-translate-x-1 hover:-translate-y-1 hover:shadow-paper-hover">
                    <span class="block font-bold text-gray-800 text-sm" th:text="${topic.topicName}">Topic Name</span>
                </div>
            </div>
        </div>
        <!-- Difficulty Level -->
        <div class="mb-6" id="difficulty-level">
            <div class="inline-block px-4 py-2 bg-white border-4 border-black rounded-full shadow-paper-sm mb-4 text-lg font-bold">
                Difficulty Level
            </div>
            <div class="flex justify-center items-center gap-2 my-4">
                <!-- Easy Badge -->
                <div class="difficulty-pill cursor-pointer select-none px-3 py-2 bg-white border-4 border-black rounded-3xl shadow-paper transition-all duration-200 hover:transform hover:-translate-x-1 hover:-translate-y-1 hover:shadow-paper-hover active:transform active:translate-x-0 active:translate-y-0 active:shadow-none text-center" 
                     data-difficulty="easy" onclick="selectDifficulty('easy')">
                    <span class="text-gray-800 font-bold text-xs">Easy</span>
                </div>
                
                <!-- Medium Badge -->
                <div class="difficulty-pill cursor-pointer select-none px-3 py-2 bg-white border-4 border-black rounded-3xl shadow-paper transition-all duration-200 hover:transform hover:-translate-x-1 hover:-translate-y-1 hover:shadow-paper-hover active:transform active:translate-x-0 active:translate-y-0 active:shadow-none text-center" 
                     data-difficulty="medium" onclick="selectDifficulty('medium')">
                    <span class="text-gray-800 font-bold text-xs">Medium</span>
                </div>
                
                <!-- Hard Badge -->
                <div class="difficulty-pill cursor-pointer select-none px-3 py-2 bg-white border-4 border-black rounded-3xl shadow-paper transition-all duration-200 hover:transform hover:-translate-x-1 hover:-translate-y-1 hover:shadow-paper-hover active:transform active:translate-x-0 active:translate-y-0 active:shadow-none text-center" 
                     data-difficulty="hard" onclick="selectDifficulty('hard')">
                    <span class="text-gray-800 font-bold text-xs">Hard</span>
                </div>
                
                <!-- Mixed Badge -->
                <div class="difficulty-pill cursor-pointer select-none px-3 py-2 bg-white border-4 border-black rounded-3xl shadow-paper transition-all duration-200 hover:transform hover:-translate-x-1 hover:-translate-y-1 hover:shadow-paper-hover active:transform active:translate-x-0 active:translate-y-0 active:shadow-none text-center" 
                     data-difficulty="mixed" onclick="selectDifficulty('mixed')">
                    <span class="text-gray-800 font-bold text-xs">Mixed</span>
                </div>
            </div>
        </div>
    
        <!-- Question Count Slider -->
        <div class="text-center mb-8">
            <div class="inline-block px-4 py-2 bg-white border-4 border-black rounded-full shadow-paper-sm mb-4 text-lg font-bold">
                Number of Questions
            </div>
            <div class="flex flex-col items-center px-4">
                <div class="text-xs text-gray-600 mb-4">
                    Questions will be selected from all topics to ensure balanced coverage
                </div>
                <div class="w-full max-w-xs">
                    <input type="range" id="questionCount" name="questionCount" 
                           min="10" th:max="${quiz.totalQuestions}" 
                           th:value="${quiz.totalQuestions}" 
                           class="w-full h-2 bg-black rounded appearance-none cursor-pointer outline-none slider">
                </div>
                <div class="text-lg font-bold text-gray-800 mt-2">
                    <span id="questionCountValue" th:text="${quiz.totalQuestions}">20</span> 
                    / <span th:text="${quiz.totalQuestions}">20</span>
                </div>
            </div>
        </div>
        
        <form th:action="@{/quiz/start/{quizId}(quizId=${quiz.id})}" method="post" class="mt-6">
            <input type="hidden" id="selectedQuestionCount" name="questionCount" th:value="${quiz.totalQuestions}">
            <input type="hidden" id="selectedDifficulty" name="difficulty" value="easy">
            <button type="submit" class="w-full bg-black text-white font-bold text-lg px-8 py-3 rounded-xl border-4 border-black shadow-paper transition-all duration-200 hover:transform hover:-translate-x-1 hover:-translate-y-1 hover:shadow-paper-hover active:transform active:translate-x-0 active:translate-y-0 active:shadow-none">
                START
            </button>
        </form>
    </div>
</div>

<script>
    // Topics toggle functionality
    function toggleTopics() {
        const container = document.getElementById('topicsContainer');
        const icon = document.querySelector('.toggle-icon');
        
        container.classList.toggle('show');
        
        if (container.classList.contains('show')) {
            icon.textContent = 'â–¼';
        } else {
            icon.textContent = 'â–¶';
        }
    }

    // Question count slider functionality
    const slider = document.getElementById('questionCount');
    const valueDisplay = document.getElementById('questionCountValue');
    const hiddenInput = document.getElementById('selectedQuestionCount');
    
    slider.addEventListener('input', function() {
        const value = this.value;
        valueDisplay.textContent = value;
        hiddenInput.value = value;
    });
    
    // Initialize the display
    valueDisplay.textContent = slider.value;
    hiddenInput.value = slider.value;
    
    // Difficulty pill functionality
    const hiddenDifficulty = document.getElementById('selectedDifficulty');
    const selectedIcon = document.getElementById('selectedIcon');
    const selectedDifficultyText = document.getElementById('selectedDifficultyText');
    
    function selectDifficulty(difficulty) {
        console.log('Selecting difficulty:', difficulty);
        
        // Update hidden input
        hiddenDifficulty.value = difficulty;
        
        // Reset all pills to default state
        document.querySelectorAll('.difficulty-pill').forEach(pill => {
            pill.classList.remove('selected');
            pill.style.backgroundColor = '';
            pill.style.transform = '';
            pill.style.boxShadow = '';
        });
        
        // Highlight selected pill
        const selectedPill = document.querySelector(`[data-difficulty="${difficulty}"]`);
        if (selectedPill) {
            selectedPill.classList.add('selected');
            selectedPill.style.backgroundColor = '#f8f8f8';
            selectedPill.style.transform = 'translate(0, 0)';
            selectedPill.style.boxShadow = 'none';
        }
        
        // Update selected display
        const difficultyConfig = {
            'easy': { icon: 'ðŸ˜Š', text: 'Easy' },
            'medium': { icon: 'ðŸ¤”', text: 'Medium' },
            'hard': { icon: 'ðŸ˜¤', text: 'Hard' },
            'mixed': { icon: 'ðŸŽ¯', text: 'Mixed' }
        };
        
        const config = difficultyConfig[difficulty];
        selectedIcon.textContent = config.icon;
        selectedDifficultyText.textContent = config.text;
    }
    
    // Add click event listeners to difficulty pills
    document.querySelectorAll('.difficulty-pill').forEach(pill => {
        pill.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const difficulty = this.getAttribute('data-difficulty');
            console.log('Clicked difficulty pill with difficulty:', difficulty);
            selectDifficulty(difficulty);
        });
    });
    
    // Initialize with easy difficulty
    selectDifficulty('easy');
</script>
</body>
</html>