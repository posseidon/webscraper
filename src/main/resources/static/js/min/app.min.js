document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("breadcrumb");e&&e.querySelectorAll("#title-breadcrumb span, #topic-breadcrumb span").forEach(t=>{let a=t.textContent.trim(),n=a.split(" ");function e(){var e;20<a.length&&2<n.length?(e=n.slice(0,2),t.textContent=e.join(" ")+" ..."):t.textContent=a}e(),window.addEventListener("resize",e)})});class LanguageManager{constructor(){this.supportedLanguages=["en","hu","vi"],this.defaultLanguage="en",this.currentLanguage=this.detectLanguage(),this.translations={},this.init()}detectLanguage(){var e=localStorage.getItem("quiz-app-language");return e&&this.supportedLanguages.includes(e)||(e=(navigator.language||navigator.languages[0]||this.defaultLanguage).toLowerCase().split("-")[0],this.supportedLanguages.includes(e))?e:this.defaultLanguage}async init(){await this.loadTranslations(),this.applyTranslations(),this.updateLanguageSelector(),this.setupEventListeners()}async loadTranslations(){try{var e,t=await fetch(`/js/translations/${this.currentLanguage}.json`);t.ok?this.translations=await t.json():"en"!==this.currentLanguage&&(e=await fetch("/js/translations/en.json"),this.translations=await e.json())}catch(e){}}translate(e,t=null){return this.translations[e]||t||e}async setLanguage(e){this.supportedLanguages.includes(e)&&(this.currentLanguage=e,localStorage.setItem("quiz-app-language",e),await this.loadTranslations(),this.applyTranslations(),this.updateLanguageSelector())}applyTranslations(){document.querySelectorAll("[data-translate]").forEach(e=>{var t=e.getAttribute("data-translate"),a=e.getAttribute("data-original-text")||e.textContent;e.getAttribute("data-original-text")||e.setAttribute("data-original-text",a);let n=this.translate(t,a);n.includes("{}")&&(t=a.match(/Explore (\w+) topics/))&&(n=n.replace("{}",t[1].toLowerCase())),e.textContent=n}),document.querySelectorAll("[data-translate-placeholder]").forEach(e=>{var t=e.getAttribute("data-translate-placeholder"),a=e.getAttribute("data-original-placeholder")||e.placeholder;e.getAttribute("data-original-placeholder")||e.setAttribute("data-original-placeholder",a),e.placeholder=this.translate(t,a)}),document.querySelectorAll("[data-translate-title]").forEach(e=>{var t=e.getAttribute("data-translate-title"),a=e.getAttribute("data-original-title")||e.title;e.getAttribute("data-original-title")||e.setAttribute("data-original-title",a),e.title=this.translate(t,a)})}updateLanguageSelector(){var e=document.getElementById("language-selector");e&&(e.value=this.currentLanguage)}setupEventListeners(){var e=document.getElementById("language-selector");e&&e.addEventListener("change",e=>{this.setLanguage(e.target.value)}),document.querySelectorAll(".language-option").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=t.getAttribute("data-lang");e&&this.setLanguage(e)})});let t=document.getElementById("language-submenu-toggle"),a=document.getElementById("language-submenu"),n=document.getElementById("language-submenu-arrow");t&&a&&n&&t.addEventListener("click",e=>{e.preventDefault(),"true"===t.getAttribute("aria-expanded")?(a.classList.add("hidden"),t.setAttribute("aria-expanded","false"),n.style.transform="rotate(0deg)"):(a.classList.remove("hidden"),t.setAttribute("aria-expanded","true"),n.style.transform="rotate(90deg)")}),document.addEventListener("click",e=>{(e.target.matches("[data-modal-toggle]")||e.target.closest("[data-modal-toggle]"))&&setTimeout(()=>{this.applyTranslations()},100)}),new MutationObserver(e=>{let t=!1;e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.matches("[data-translate]")||e.querySelector("[data-translate]"))&&(t=!0)})}),t&&setTimeout(()=>this.applyTranslations(),50)}).observe(document.body,{childList:!0,subtree:!0})}refreshTranslations(e=document){e.querySelectorAll("[data-translate]").forEach(e=>{var t=e.getAttribute("data-translate"),a=e.getAttribute("data-original-text")||e.textContent;e.getAttribute("data-original-text")||e.setAttribute("data-original-text",a);let n=this.translate(t,a);n.includes("{}")&&(t=a.match(/Explore (\w+) topics/))&&(n=n.replace("{}",t[1].toLowerCase())),e.textContent=n})}getLanguageInfo(){return{code:this.currentLanguage,name:{en:"English",hu:"Magyar",vi:"Tiếng Việt"}[this.currentLanguage]||this.currentLanguage}}}function t(e,t=null){return window.languageManager?window.languageManager.translate(e,t):t||e}function startTitleQuiz(e){var t=document.querySelector('select[name="difficulty"]').value,a=document.getElementById("numQuestions"),a=a?a.value:10,n=document.createElement("form"),e=(n.method="POST",n.action="/quiz/start/"+encodeURIComponent(e),document.createElement("input")),t=(e.type="hidden",e.name="difficulty",e.value=t,n.appendChild(e),document.createElement("input"));t.type="hidden",t.name="questionCount",t.value=a.toString(),n.appendChild(t),document.body.appendChild(n),n.submit()}document.addEventListener("DOMContentLoaded",()=>{window.languageManager=new LanguageManager}),document.addEventListener("DOMContentLoaded",()=>{let a=document.getElementById("numQuestions");var e,t=parseInt(a.dataset.totalQuestions);a&&!isNaN(t)&&(e=((t,a,e)=>{var n=new Set;if(console.log(`Generating options between ${t} and ${a} aiming for ${e} options.`),t<=a&&(n.add(t),n.add(a)),a<t)return n.has(a)||n.add(a),Array.from(n).sort((e,t)=>e-t);var r=Math.max(2,e),i=(a-t)/(r-1);for(let e=1;e<r-1;e++){var o=Math.round(t+e*i);t<o&&o<a&&n.add(o)}return Array.from(n).sort((e,t)=>e-t)})(3,t,10),a.innerHTML="",e.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}),e.includes(t)?a.value=t:0<e.length&&(a.value=e[e.length-1]));let n=document.getElementById("start-quiz-btn");n&&n.addEventListener("click",async()=>{var e=n.dataset.quizId,t=document.querySelector('input[name="difficulty"]:checked'),t=(t&&t.dataset.difficulty,document.getElementById("numQuestions"));t&&t.value;startTitleQuiz(e)})});let questions=[],totalQuestions=0,currentQuestionIndex=0,selectedAnswers=[],correctAnswers=0,wrongAnswers=[],quizStartTime=new Date,quizResults={},currentLanguageFilter="all",speedDialMenuJustOpened=!1;function initializeQuizData(e){questions=e||[],totalQuestions=questions.length,quizResults={totalQuestions:totalQuestions,correctAnswers:0,wrongAnswers:[],completedAt:null}}function setupEventListeners(){var e=document.getElementById("actionBtn"),e=(e&&e.addEventListener("click",handleActionButton),document.getElementById("finishQuizBtn")),e=(e&&e.addEventListener("click",finishQuiz),document.getElementById("close-explanation-modal")),t=document.getElementById("close-explanation-modal-footer"),a=document.getElementById("continue-quiz-btn"),e=(e&&e.addEventListener("click",function(e){e.preventDefault(),hideExplanationModal()}),t&&t.addEventListener("click",function(e){e.preventDefault(),hideExplanationModal()}),a&&a.addEventListener("click",function(e){e.preventDefault(),hideExplanationModal(),(currentQuestionIndex<questions.length-1?nextQuestion:showEvaluation)()}),document.getElementById("flipCardBtn")),t=(e&&e.addEventListener("click",function(){var e=document.getElementById("flip-card");e.style.transform="rotateY(180deg)"===e.style.transform?"":"rotateY(180deg)"}),document.getElementById("language-chooser-btn"));let n=document.getElementById("language-chooser");t&&n&&t.addEventListener("click",function(){n.classList.toggle("hidden")})}function loadQuestion(e){if(e>=questions.length)showEvaluation();else{hideExplanationModal();var t=questions[e],a=(currentQuestionIndex=e,document.getElementById("currentQuestionNum")),r=document.getElementById("totalQuestions"),a=(a&&(a.textContent=e+1),r&&(r.textContent=totalQuestions),updateQuestionProgress(),document.getElementById("questionText"));a&&(a.textContent=t.question,a.removeAttribute("data-translate"));let n=document.getElementById("optionsContainer");n.innerHTML="",t.options.forEach((e,t)=>{var a=document.createElement("div");a.className="option-card cursor-pointer p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200",a.setAttribute("data-option-index",t),a.innerHTML=`
            <div class="flex items-center">
                <input type="radio" name="answer" value="${t}" class="w-4 h-4 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 border-none bg-transparent">
                <label class="ml-3 text-sm text-gray-900 dark:text-white font-medium cursor-pointer">${e}</label>
            </div>
        `,a.addEventListener("click",function(){selectOption(t)}),a.style.pointerEvents="auto",n.appendChild(a)});e=document.getElementById("actionBtn"),r=(e&&(e.className="py-2.5 px-4 bg-transparent text-black dark:text-white font-medium rounded-lg transition-colors duration-200 border-none hover:bg-gray-100 dark:hover:bg-gray-700",e.dataset.mode="submit",e.disabled=!0),document.getElementById("bottom-banner"));r&&r.classList.add("hidden")}}function selectOption(e){document.querySelectorAll(".option-card").forEach(e=>{e.classList.remove("bg-blue-100","dark:bg-blue-900","border-blue-500"),e.classList.add("border-gray-300","dark:border-gray-600")});e=document.querySelector(`[data-option-index="${e}"]`);e.classList.remove("border-gray-300","dark:border-gray-600"),e.classList.add("bg-blue-100","dark:bg-blue-900","border-blue-500");e.querySelector('input[type="radio"]').checked=!0;e=document.getElementById("actionBtn");e&&(e.disabled=!1)}function submitAnswer(){var e=document.querySelector('input[name="answer"]:checked');if(e){let r=parseInt(e.value);e=questions[currentQuestionIndex];let i=e.correctAnswer||e.correct_answer;selectedAnswers[currentQuestionIndex]=r,document.querySelectorAll(".option-card").forEach((e,t)=>{var a,n=t===r,t=t===i;e.classList.remove("bg-blue-100","dark:bg-blue-900","border-blue-500","border-gray-300","dark:border-gray-600","bg-green-100","dark:bg-green-900","border-green-500","bg-red-100","dark:bg-red-900","border-red-500"),t?(e.classList.add("bg-green-100","dark:bg-green-900","border-green-500","border-2"),(t=e.querySelector("label"))&&!t.querySelector(".correct-icon")&&((a=document.createElement("span")).className="correct-icon ml-2 text-green-600 dark:text-green-400",a.innerHTML="✓",t.appendChild(a))):n?(e.classList.add("bg-red-100","dark:bg-red-900","border-red-500","border-2"),(t=e.querySelector("label"))&&!t.querySelector(".wrong-icon")&&((a=document.createElement("span")).className="wrong-icon ml-2 text-red-600 dark:text-red-400",a.innerHTML="✗",t.appendChild(a))):e.classList.add("border-gray-300","dark:border-gray-600"),e.style.pointerEvents="none"}),r===i?(correctAnswers++,quizResults.correctAnswers++):(wrongAnswers.push({questionIndex:currentQuestionIndex,question:e,selectedAnswer:r,correctAnswer:i}),quizResults.wrongAnswers.push({questionIndex:currentQuestionIndex,question:e,selectedAnswer:r,correctAnswer:i})),r!==i&&showExplanationModal(e.explanation);var t,e=document.getElementById("actionBtn");e&&(currentQuestionIndex<questions.length-1?(e.innerHTML='<span data-translate="quiz.next">Next</span>',e.className="py-2.5 px-4 bg-transparent text-black dark:text-white font-medium rounded-lg transition-colors duration-200 border-none hover:bg-gray-100 dark:hover:bg-gray-700",e.dataset.mode="next",window.languageManager&&(t=e.querySelector("span"))&&(t.textContent=window.languageManager.translate("quiz.next"))):(e.innerHTML='<span data-translate="quiz.finish">Finish Quiz</span>',e.className="py-2.5 px-4 bg-transparent text-black dark:text-white font-medium rounded-lg transition-colors duration-200 border-none hover:bg-gray-100 dark:hover:bg-gray-700",e.dataset.mode="evaluate",window.languageManager&&(t=e.querySelector("span"))&&(t.textContent=window.languageManager.translate("quiz.finish"))))}else alert("Please select an answer before submitting.")}function handleActionButton(e){e&&e.target&&("language-speed-dial-btn"===e.target.id||e.target.closest("#language-speed-dial-btn")||e.target.closest("#helper-speed-dial")||e.target.closest("#speed-dial-menu-bottom-right")||"vietnamese-filter-btn"===e.target.id||"hungarian-filter-btn"===e.target.id||"all-filter-btn"===e.target.id)?(e.preventDefault(),e.stopPropagation()):"submit"===(e=document.getElementById("actionBtn").dataset.mode)?submitAnswer():"next"===e?nextQuestion():"evaluate"===e&&showEvaluation()}function nextQuestion(){hideExplanationModal(),loadQuestion(currentQuestionIndex+1)}function showExplanationModal(e){var t=document.getElementById("explanation-modal"),a=document.getElementById("modal-explanation-text"),n=document.getElementById("helper-speed-dial");t&&a&&(n&&n.classList.add("hidden"),a.innerHTML="",a.removeAttribute("data-translate"),e&&e.trim()?a.textContent=e:window.languageManager?a.textContent=window.languageManager.translate("quiz.no_explanation")||"No explanation available for this question.":a.innerHTML='<span data-translate="quiz.no_explanation">No explanation available for this question.</span>',t.classList.remove("hidden"),t.classList.add("flex"),t.setAttribute("aria-hidden","false"),document.body.classList.add("overflow-hidden"))}function hideExplanationModal(){var e=document.getElementById("explanation-modal"),t=document.getElementById("helper-speed-dial");e&&!e.classList.contains("hidden")&&(e.classList.add("hidden"),e.classList.remove("flex"),e.setAttribute("aria-hidden","true"),document.body.classList.remove("overflow-hidden"),t)&&t.classList.remove("hidden")}function showEvaluation(){hideExplanationModal();var e=document.getElementById("helper-speed-dial"),e=(e&&e.classList.add("hidden"),quizResults.completedAt=new Date,Math.round(correctAnswers/totalQuestions*100));document.getElementById("questionContainer").classList.add("hidden"),document.getElementById("resultsContainer").classList.remove("hidden"),document.getElementById("scorePercentage").textContent=e+"%",document.getElementById("correctAnswers").textContent=correctAnswers,document.getElementById("totalQuestionsResult").textContent=totalQuestions,0<wrongAnswers.length?displayWrongAnswers():document.getElementById("wrongAnswersSection").classList.add("hidden")}function displayWrongAnswers(){let a=document.getElementById("wrongAnswersList");a.innerHTML="",wrongAnswers.forEach(e=>{var t=document.createElement("div");t.className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm p-6",t.innerHTML=`
            <div class="mb-4">
                <h4 class="text-base font-semibold text-gray-900 dark:text-white mb-2">
                    ${window.languageManager?window.languageManager.translate("quiz.question_label"):"Question"} ${e.questionIndex+1}:
                </h4>
                <p class="text-gray-700 dark:text-gray-300">${e.question.question}</p>
            </div>
            
            <div class="space-y-3">
                <div class="flex items-start space-x-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">
                        ${window.languageManager?window.languageManager.translate("quiz.your_answer"):"Your Answer"}
                    </span>
                    <span class="text-gray-700 dark:text-gray-300">${e.question.options[e.selectedAnswer]}</span>
                </div>
                
                <div class="flex items-start space-x-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">
                        ${window.languageManager?window.languageManager.translate("quiz.correct_answer"):"Correct Answer"}
                    </span>
                    <span class="text-gray-700 dark:text-gray-300">${e.question.options[e.correctAnswer]}</span>
                </div>
                
                ${e.question.explanation?`
                <div class="pt-3 border-t border-gray-200 dark:border-gray-700">
                    <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-1">${window.languageManager?window.languageManager.translate("quiz.explanation"):"Explanation:"}</h5>
                    <p class="text-sm text-gray-600 dark:text-gray-400">${e.question.explanation}</p>
                </div>
                `:""}
            </div>
        `,a.appendChild(t)})}function updateQuestionProgress(){var e,t=document.getElementById("progressBar").querySelector("div");t&&0<totalQuestions&&(e=Math.round((currentQuestionIndex+1)/totalQuestions*100),t.style.width=e+"%")}function finishQuiz(){fetch("/quiz/submit-results",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(quizResults)}).then(e=>e.json()).then(e=>{var t=new URLSearchParams(window.location.search),a=t.get("category"),t=t.get("subcategory"),n=window.currentQuizTitle||null;window.location.href=a&&t?`/quiz/${a}/${t}/`+n:"/quiz/categories"}).catch(e=>{var t=new URLSearchParams(window.location.search),a=t.get("category"),t=t.get("subcategory");window.location.href=a&&t?`/quiz/${a}/${t}/`+titles:"/quiz/categories"})}function setupLanguageFilterListeners(){var e=document.getElementById("language-speed-dial-btn"),t=document.getElementById("speed-dial-menu-bottom-right"),t=(document.getElementById("helper-speed-dial"),e&&t&&(t.classList.remove("flex"),t.classList.add("hidden"),t.style.display="none",t.style.pointerEvents="none",e.setAttribute("aria-expanded","false"),e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),toggleSpeedDialMenu()})),document.getElementById("vietnamese-filter-btn")),e=document.getElementById("hungarian-filter-btn"),a=document.getElementById("all-filter-btn");t&&t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),setLanguageFilter("vietnamese")}),e&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),setLanguageFilter("hungarian")}),a&&a.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),setLanguageFilter("all")})}function toggleSpeedDialMenu(){var e,t,a=document.getElementById("speed-dial-menu-bottom-right"),n=document.getElementById("language-speed-dial-btn");a&&n&&(e=a.classList.contains("hidden"),t="none"===window.getComputedStyle(a).display,e||t?(a.classList.remove("hidden"),a.classList.add("flex"),a.style.display="flex",a.style.pointerEvents="auto",n.setAttribute("aria-expanded","true"),speedDialMenuJustOpened=!0,setTimeout(()=>{speedDialMenuJustOpened=!1},100)):(a.classList.remove("flex"),a.classList.add("hidden"),a.style.display="none",a.style.pointerEvents="none",n.setAttribute("aria-expanded","false")))}function setLanguageFilter(e){speedDialMenuJustOpened||(currentLanguageFilter=e,updateFilterButtonStates(),applyLanguageFilter(),hideSpeedDialMenu())}function hideSpeedDialMenu(){var e=document.getElementById("speed-dial-menu-bottom-right"),t=document.getElementById("language-speed-dial-btn");e&&t&&(e.classList.remove("flex"),e.classList.add("hidden"),e.style.display="none",e.style.pointerEvents="none",t.setAttribute("aria-expanded","false"))}function updateFilterButtonStates(){["vietnamese-filter-btn","hungarian-filter-btn","all-filter-btn"].forEach(e=>{e=document.getElementById(e);e&&e.classList.remove("ring-2","ring-blue-500")});let e="all-filter-btn";"vietnamese"===currentLanguageFilter?e="vietnamese-filter-btn":"hungarian"===currentLanguageFilter&&(e="hungarian-filter-btn");var t=document.getElementById(e);t&&t.classList.add("ring-2","ring-blue-500")}function applyLanguageFilter(){var e,t=document.getElementById("questionText");t&&questions[currentQuestionIndex]&&(e=filterText(questions[currentQuestionIndex].question),t.textContent=e),document.querySelectorAll(".option-card").forEach((e,t)=>{let a=e.querySelector("label");a&&questions[currentQuestionIndex]&&questions[currentQuestionIndex].options[t]&&(e=filterText(questions[currentQuestionIndex].options[t]),t=a.querySelectorAll(".correct-icon, .wrong-icon"),a.innerHTML=e,t.forEach(e=>a.appendChild(e)))})}function filterText(e){if(!e)return"";switch(currentLanguageFilter){case"vietnamese":var t=e.match(/\(([^)]+)\)/g);return t?t.map(e=>e.slice(1,-1)).join(" "):e;case"hungarian":return e.replace(/\s*\([^)]*\)/g,"").trim();default:return e}}document.addEventListener("DOMContentLoaded",function(){function a(){var e;window.quizQuestionsData&&Array.isArray(window.quizQuestionsData)&&0<window.quizQuestionsData.length?(initializeQuizData(window.quizQuestionsData),0<questions.length?loadQuestion(0):((e=document.getElementById("questionText")).removeAttribute("data-translate"),window.languageManager?e.textContent=window.languageManager.translate("quiz.error")||"No questions available for this quiz.":e.textContent="No questions available for this quiz.")):((e=document.getElementById("questionText")).removeAttribute("data-translate"),window.languageManager?e.textContent=window.languageManager.translate("quiz.error")||"Error loading quiz data.":e.textContent="Error loading quiz data."),setupEventListeners(),setTimeout(()=>{setupLanguageFilterListeners()},100)}if(window.languageManager&&window.languageManager.currentLanguage)a();else{let e=0,t=()=>{e++,(!window.languageManager||!window.languageManager.currentLanguage)&&e<50?setTimeout(t,100):a()};setTimeout(t,100)}});let originalLoadQuestion=loadQuestion;function handleCustomAccordionClick(e){e.preventDefault(),e.stopPropagation();var t,e=this.getAttribute("data-accordion-target"),e=document.querySelector(e),a=this.closest("[data-custom-accordion]");e&&a&&(t=!e.classList.contains("hidden"),a.querySelectorAll("[data-accordion-target]").forEach(e=>{var t=e.getAttribute("data-accordion-target"),t=document.querySelector(t),a=e.querySelector("[data-accordion-icon]");t&&(t.classList.add("hidden"),e.setAttribute("aria-expanded","false"),a)&&a.classList.remove("rotate-180")}),!t)&&(e.classList.remove("hidden"),this.setAttribute("aria-expanded","true"),a=this.querySelector("[data-accordion-icon]"))&&a.classList.add("rotate-180")}function updateTimeEstimator(e,t){var a,n=document.getElementById("time-display-"+e),r=document.getElementById("progressCircle-"+e);document.querySelectorAll('[id*="time-display"]'),document.querySelectorAll('[id*="progress-circle"]');n&&(a=Math.round(10*t/60*10)/10,n.textContent=a.toFixed(1),r)&&((n=document.querySelector(`[id="questions-range-${e}"]`))?(a=parseInt(n.max),e=parseInt(t),n=Math.round(e/a*100),Math.round(n/100*50),setProgress(r,n)):setProgress(r,100))}function setProgress(e,t){var a;e&&(a=e.r.baseVal.value,a=2*Math.PI*a,e.style.strokeDasharray=a+" "+a,e.style.strokeDashoffset=a-t/100*a)}function updateDifficultySelection(e){document.querySelectorAll('input[name="difficulty"]').forEach(e=>{var t=document.querySelector(`label[for="${e.id}"]`);if(t){var a=e.getAttribute("data-difficulty");if(t.classList.remove("border-green-500","bg-green-50","dark:border-green-400","dark:bg-green-900/20","border-yellow-500","bg-yellow-50","dark:border-yellow-400","dark:bg-yellow-900/20","border-red-500","bg-red-50","dark:border-red-400","dark:bg-red-900/20","border-blue-500","bg-blue-50","dark:border-blue-400","dark:bg-blue-900/20"),t.classList.add("border-gray-200","dark:border-gray-600"),e.checked)switch(t.classList.remove("border-gray-200","dark:border-gray-600"),a){case"easy":t.classList.add("border-green-500","bg-green-50","dark:border-green-400","dark:bg-green-900/20");break;case"medium":t.classList.add("border-yellow-500","bg-yellow-50","dark:border-yellow-400","dark:bg-yellow-900/20");break;case"hard":t.classList.add("border-red-500","bg-red-50","dark:border-red-400","dark:bg-red-900/20");break;case"mixed":t.classList.add("border-blue-500","bg-blue-50","dark:border-blue-400","dark:bg-blue-900/20")}}})}function updateQuestionCount(e,t){e=document.getElementById("question-count-"+e);e&&(e.textContent=t)}function updateSliderValueDisplay(e,t,a){let n=document.getElementById("slider-value-"+t);var r,i;n&&(n.textContent=a,t=parseFloat(e.min),r=parseFloat(e.max),a=parseFloat(a),i=e.offsetWidth,n.style.left=(a-t)/(r-t)*(i-20)+10+"px",n.style.opacity="1",clearTimeout(n.hideTimeout),n.hideTimeout=setTimeout(()=>{e.matches(":hover")||e.matches(":focus")||(n.style.opacity="0")},1500))}function initializeAccordions(){document.querySelectorAll("[data-custom-accordion]").forEach(e=>{e.querySelectorAll("[data-accordion-target]").forEach((e,t)=>{var a=e.getAttribute("data-accordion-target"),a=document.querySelector(a),n=e.querySelector("[data-accordion-icon]");a&&(a.classList.add("hidden"),e.setAttribute("aria-expanded","false"),n)&&n.classList.remove("rotate-180")})})}function startQuiz(e,a,t,n){var r=a.replace(/[^a-zA-Z0-9]/g,"-"),i=document.getElementById("quiz-modal-"+r);if(i){i=i.querySelector('input[name="difficulty"]:checked');let e=i?i.getAttribute("data-difficulty"):"mixed";i=document.getElementById("questions-range-"+r);let t=i?i.value:10;submitQuizForm(a,e,t)}else void submitQuizForm(a,"mixed",10)}function submitQuizForm(e,t,a){var n=document.createElement("form"),e=(n.method="POST",n.action="/quiz/start/"+encodeURIComponent(e),document.createElement("input")),a=(e.type="hidden",e.name="questionCount",e.value=a,n.appendChild(e),document.createElement("input"));a.type="hidden",a.name="difficulty",a.value=t,n.appendChild(a),document.body.appendChild(n),n.submit()}function updateTopicTimeEstimator(e,t){var a,n=document.getElementById("time-display-"+e),r=document.getElementById("progressCircle-"+e);n&&(a=Math.round(10*t/60*10)/10,n.textContent=a.toFixed(1),r)&&((n=document.querySelector(`[id="topic-questions-range-${e}"]`))?(a=parseInt(n.max),e=parseInt(t),n=Math.round(e/a*100),setProgress(r,n)):setProgress(r,100))}function setProgress(e,t){var a;e&&(a=e.r.baseVal.value,a=2*Math.PI*a,e.style.strokeDasharray=a+" "+a,e.style.strokeDashoffset=a-t/100*a)}function updateTopicDifficultySelection(e){e=e.id.replace(/^topic-(easy|medium|hard|mixed)-/,"");document.querySelectorAll(`input[name="topic-difficulty-${e}"]`).forEach(e=>{var t=document.querySelector(`label[for="${e.id}"]`);if(t){var a=e.getAttribute("data-difficulty");if(t.classList.remove("border-green-500","bg-green-50","dark:border-green-400","dark:bg-green-900/20","border-yellow-500","bg-yellow-50","dark:border-yellow-400","dark:bg-yellow-900/20","border-red-500","bg-red-50","dark:border-red-400","dark:bg-red-900/20","border-blue-500","bg-blue-50","dark:border-blue-400","dark:bg-blue-900/20"),t.classList.add("border-gray-200","dark:border-gray-600"),e.checked)switch(t.classList.remove("border-gray-200","dark:border-gray-600"),a){case"easy":t.classList.add("border-green-500","bg-green-50","dark:border-green-400","dark:bg-green-900/20");break;case"medium":t.classList.add("border-yellow-500","bg-yellow-50","dark:border-yellow-400","dark:bg-yellow-900/20");break;case"hard":t.classList.add("border-red-500","bg-red-50","dark:border-red-400","dark:bg-red-900/20");break;case"mixed":t.classList.add("border-blue-500","bg-blue-50","dark:border-blue-400","dark:bg-blue-900/20")}}})}function updateTopicSliderValueDisplay(e,t,a){let n=document.getElementById("slider-value-"+t);var r,i;n&&(n.textContent=a,t=parseFloat(e.min),r=parseFloat(e.max),a=parseFloat(a),i=e.offsetWidth,n.style.left=(a-t)/(r-t)*(i-20)+10+"px",n.style.opacity="1",clearTimeout(n.hideTimeout),n.hideTimeout=setTimeout(()=>{e.matches(":hover")||e.matches(":focus")||(n.style.opacity="0")},1500))}function playTopicQuiz(e,t){e?showTopicQuizModal(e):alert("Error: Topic ID is missing. Cannot start quiz.")}function showTopicQuizModal(a){var e=a.replace(/[^a-zA-Z0-9]/g,"-");let n=document.getElementById("topic-quiz-modal-"+e);if(n){n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),n.setAttribute("tabindex","0"),document.body.classList.add("overflow-hidden"),n.focus(),n.addEventListener("click",function(e){e.target===n&&hideTopicQuizModal(a)});let t=function(e){"Escape"===e.key&&(hideTopicQuizModal(a),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t)}else startTopicQuizDirectly(a)}function hideTopicQuizModal(e){e=e.replace(/[^a-zA-Z0-9]/g,"-"),e=document.getElementById("topic-quiz-modal-"+e);e&&(e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.removeAttribute("tabindex"),document.body.classList.remove("overflow-hidden"))}function startTopicQuizDirectly(e){var t=document.createElement("form");t.method="POST",t.action="/quiz/play/"+encodeURIComponent(e),document.body.appendChild(t),t.submit()}function startTopicQuiz(e,t,a,n,r){var i=document.querySelector(`input[name="topic-difficulty-${e.replace(/[^a-zA-Z0-9]/g,"-")}"]:checked`),i=i?i.getAttribute("data-difficulty"):"mixed",o=document.getElementById("topic-questions-range-"+e.replace(/[^a-zA-Z0-9]/g,"-")),o=o?parseInt(o.value):0,d=document.createElement("form"),e=(d.method="POST",d.action="/quiz/start/"+encodeURIComponent(e),document.createElement("input")),i=(e.type="hidden",e.name="difficulty",e.value=i,d.appendChild(e),document.createElement("input"));i.type="hidden",i.name="questionCount",i.value=o.toString(),d.appendChild(i),document.body.appendChild(d),d.submit()}function showTitleQuizModal(){let a=document.querySelector('[id^="quiz-modal-"]');if(a){a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),a.setAttribute("tabindex","0"),document.body.classList.add("overflow-hidden"),a.focus(),a.addEventListener("click",function(e){e.target===a&&hideTitleQuizModal()});let t=function(e){"Escape"===e.key&&(hideTitleQuizModal(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t)}}function hideTitleQuizModal(){var e=document.querySelector('[id^="quiz-modal-"]');e&&(e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.removeAttribute("tabindex"),document.body.classList.remove("overflow-hidden"))}function startTitleQuiz(e,t){var a=document.querySelector('input[name="difficulty"]:checked'),a=a?a.getAttribute("data-difficulty"):"mixed",n=document.querySelector('[id^="questions-range-"]'),n=n?parseInt(n.value):0,r=document.createElement("form"),e=(r.method="POST",r.action="/quiz/start/"+encodeURIComponent(e),document.createElement("input")),a=(e.type="hidden",e.name="difficulty",e.value=a,r.appendChild(e),document.createElement("input"));a.type="hidden",a.name="questionCount",a.value=n.toString(),r.appendChild(a),console.log(r),document.body.appendChild(r),r.submit()}function updateMainQuizDifficultySelection(e){document.querySelectorAll('input[name="difficulty"]').forEach(e=>{var t=document.querySelector(`label[for="${e.id}"]`);if(t){var a=e.getAttribute("data-difficulty");if(t.classList.remove("border-green-500","bg-green-50","dark:border-green-400","dark:bg-green-900/20","border-yellow-500","bg-yellow-50","dark:border-yellow-400","dark:bg-yellow-900/20","border-red-500","bg-red-50","dark:border-red-400","dark:bg-red-900/20","border-blue-500","bg-blue-50","dark:border-blue-400","dark:bg-blue-900/20"),t.classList.add("border-gray-200","dark:border-gray-600"),e.checked)switch(t.classList.remove("border-gray-200","dark:border-gray-600"),a){case"easy":t.classList.add("border-green-500","bg-green-50","dark:border-green-400","dark:bg-green-900/20");break;case"medium":t.classList.add("border-yellow-500","bg-yellow-50","dark:border-yellow-400","dark:bg-yellow-900/20");break;case"hard":t.classList.add("border-red-500","bg-red-50","dark:border-red-400","dark:bg-red-900/20");break;case"mixed":t.classList.add("border-blue-500","bg-blue-50","dark:border-blue-400","dark:bg-blue-900/20")}}})}function updateMainQuizTimeEstimator(e,t){var a,n=document.getElementById("time-display-"+e),r=document.getElementById("progressCircle-"+e);n&&(a=Math.round(10*t/60*10)/10,n.textContent=a.toFixed(1),r)&&((n=document.querySelector(`[id*="questions-range-${e}"]`))?(a=parseInt(n.max),e=parseInt(t),n=Math.round(e/a*100),setProgress(r,n)):setProgress(r,100))}function updateMainQuizSliderValueDisplay(e,t,a){let n=document.getElementById("slider-value-"+t);var r,i;n&&(n.textContent=a,t=parseFloat(e.min),r=parseFloat(e.max),a=parseFloat(a),i=e.offsetWidth,n.style.left=(a-t)/(r-t)*(i-20)+10+"px",n.style.opacity="1",clearTimeout(n.hideTimeout),n.hideTimeout=setTimeout(()=>{e.matches(":hover")||e.matches(":focus")||(n.style.opacity="0")},1500))}loadQuestion=function(e){originalLoadQuestion.call(this,e),setTimeout(()=>{applyLanguageFilter(),updateFilterButtonStates()},50)},window.updateTimeEstimator=updateTimeEstimator,document.addEventListener("click",function(e){var t,a=e.target.closest("[data-accordion-target]");a&&a.closest("[data-custom-accordion]")?handleCustomAccordionClick.call(a,e):((a=e.target.closest(".start-quiz-btn"))&&(e.preventDefault(),t=a.getAttribute("data-quiz-id"),startQuiz(a.getAttribute("data-quiz-title"),t,a.getAttribute("data-category"),a.getAttribute("data-subcategory"))),(t=e.target.closest(".cancel-quiz-btn"))&&(e.preventDefault(),a=t.getAttribute("data-modal-hide"),t=document.getElementById(a))&&(document.activeElement.blur(),t.classList.add("hidden"),t.setAttribute("aria-hidden","true"),t.removeAttribute("tabindex"),document.body.classList.remove("overflow-hidden")),(a=e.target.closest("label[for]"))&&(t=a.getAttribute("for"),e=document.getElementById(t))&&e.classList.contains("difficulty-radio")&&(e.checked=!0,updateDifficultySelection(e)))}),document.addEventListener("input",function(e){var t,a;"range"===e.target.type&&(updateQuestionCount(t=e.target.getAttribute("data-quiz-id"),a=e.target.value),updateTimeEstimator(t,a),updateSliderValueDisplay(e.target,t,a))}),document.addEventListener("change",function(e){var t;e.target.classList.contains("questions-range-slider")&&(updateQuestionCount(t=e.target.getAttribute("data-quiz-id"),e=e.target.value),updateTimeEstimator(t,e))}),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".questions-range-slider, .enhanced-slider").forEach(t=>{var a=t.getAttribute("data-quiz-id"),n=t.value;if(updateQuestionCount(a,n),updateTimeEstimator(a,n),t.classList.contains("enhanced-slider")){updateSliderValueDisplay(t,a,n);let e=document.getElementById("slider-value-"+a);e&&(t.addEventListener("mouseenter",()=>{clearTimeout(e.hideTimeout),e.style.opacity="1"}),t.addEventListener("mouseleave",()=>{e.hideTimeout=setTimeout(()=>{t.matches(":focus")||(e.style.opacity="0")},500)}),t.addEventListener("focus",()=>{clearTimeout(e.hideTimeout),e.style.opacity="1"}),t.addEventListener("blur",()=>{e.hideTimeout=setTimeout(()=>{e.style.opacity="0"},500)}))}}),initializeAccordions(),setTimeout(initializeAccordions,500);var e=document.querySelector('input[name="difficulty"]:checked');e&&updateDifficultySelection(e)}),window.updateTopicTimeEstimator=updateTopicTimeEstimator,document.addEventListener("click",function(e){var t,a=e.target.closest(".play-topic-quiz-btn");a?(e.preventDefault(),playTopicQuiz(a.getAttribute("data-topic-id"),a.getAttribute("data-topic-name"))):(a=e.target.closest(".topic-content-div"))?(e.preventDefault(),startTopicQuizDirectly(a.getAttribute("data-topic-id"))):(a=e.target.closest(".start-topic-quiz-btn"))?(e.preventDefault(),startTopicQuiz(a.getAttribute("data-topic-id"),a.getAttribute("data-topic-name"),a.getAttribute("data-category"),a.getAttribute("data-subcategory"),a.getAttribute("data-title"))):e.target.closest("#title-quiz-play-btn")?(e.preventDefault(),showTitleQuizModal()):(a=e.target.closest(".start-quiz-btn"))?(e.preventDefault(),t=a.getAttribute("data-quiz-id"),a=a.getAttribute("data-category"),startTitleQuiz(t,a)):((t=e.target.closest(".cancel-topic-quiz-btn"))&&(e.preventDefault(),(a=t.getAttribute("data-modal-hide"))&&a.startsWith("topic-quiz-modal-")?hideTopicQuizModal(a.replace("topic-quiz-modal-","").replace(/-/g," ")):(a=document.getElementById(a))&&(document.activeElement.blur(),a.classList.add("hidden"),a.setAttribute("aria-hidden","true"),a.removeAttribute("tabindex"),document.body.classList.remove("overflow-hidden"))),(a=e.target.closest("[data-modal-hide]"))&&!t&&(e.preventDefault(),(t=a.getAttribute("data-modal-hide"))&&t.startsWith("quiz-modal-")?hideTitleQuizModal():t&&t.startsWith("topic-quiz-modal-")?hideTopicQuizModal(t.replace("topic-quiz-modal-","").replace(/-/g," ")):(a=document.getElementById(t))&&(document.activeElement.blur(),a.classList.add("hidden"),a.setAttribute("aria-hidden","true"),a.removeAttribute("tabindex"),document.body.classList.remove("overflow-hidden"))),e.target.closest(".cancel-quiz-btn")&&(e.preventDefault(),hideTitleQuizModal()),(t=e.target.closest("label[for]"))&&(a=t.getAttribute("for"),e=document.getElementById(a))&&e.classList.contains("difficulty-radio")&&(e.checked=!0,(a.includes("topic-")?updateTopicDifficultySelection:updateMainQuizDifficultySelection)(e)))}),document.addEventListener("input",function(e){var t,a;"range"===e.target.type&&e.target.id.includes("topic-questions-range-")&&(updateTopicTimeEstimator(t=e.target.getAttribute("data-quiz-id"),a=e.target.value),updateTopicSliderValueDisplay(e.target,t,a)),"range"===e.target.type&&e.target.id.includes("questions-range-")&&(updateMainQuizTimeEstimator(t=e.target.getAttribute("data-quiz-id"),a=e.target.value),updateMainQuizSliderValueDisplay(e.target,t,a))});