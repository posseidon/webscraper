class LanguageManager{constructor(){this.supportedLanguages=["en","hu","vi"],this.defaultLanguage="en",this.currentLanguage=this.detectLanguage(),this.translations={},this.init()}detectLanguage(){var e=localStorage.getItem("quiz-app-language");return e&&this.supportedLanguages.includes(e)||(e=(navigator.language||navigator.languages[0]||this.defaultLanguage).toLowerCase().split("-")[0],this.supportedLanguages.includes(e))?e:this.defaultLanguage}async init(){await this.loadTranslations(),this.applyTranslations(),this.updateLanguageSelector(),this.setupEventListeners()}async loadTranslations(){try{var e,t=await fetch(`/js/translations/${this.currentLanguage}.json`);t.ok?this.translations=await t.json():"en"!==this.currentLanguage&&(e=await fetch("/js/translations/en.json"),this.translations=await e.json())}catch(e){}}translate(e,t=null){return this.translations[e]||t||e}async setLanguage(e){this.supportedLanguages.includes(e)&&(this.currentLanguage=e,localStorage.setItem("quiz-app-language",e),await this.loadTranslations(),this.applyTranslations(),this.updateLanguageSelector())}applyTranslations(){document.querySelectorAll("[data-translate]").forEach(e=>{var t=e.getAttribute("data-translate"),n=e.getAttribute("data-original-text")||e.textContent;e.getAttribute("data-original-text")||e.setAttribute("data-original-text",n);let a=this.translate(t,n);a.includes("{}")&&(t=n.match(/Explore (\w+) topics/))&&(a=a.replace("{}",t[1].toLowerCase())),e.textContent=a}),document.querySelectorAll("[data-translate-placeholder]").forEach(e=>{var t=e.getAttribute("data-translate-placeholder"),n=e.getAttribute("data-original-placeholder")||e.placeholder;e.getAttribute("data-original-placeholder")||e.setAttribute("data-original-placeholder",n),e.placeholder=this.translate(t,n)}),document.querySelectorAll("[data-translate-title]").forEach(e=>{var t=e.getAttribute("data-translate-title"),n=e.getAttribute("data-original-title")||e.title;e.getAttribute("data-original-title")||e.setAttribute("data-original-title",n),e.title=this.translate(t,n)})}updateLanguageSelector(){var e=document.getElementById("language-selector");e&&(e.value=this.currentLanguage)}setupEventListeners(){var e=document.getElementById("language-selector");e&&e.addEventListener("change",e=>{this.setLanguage(e.target.value)}),document.querySelectorAll(".language-option").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=t.getAttribute("data-lang");e&&this.setLanguage(e)})});let t=document.getElementById("language-submenu-toggle"),n=document.getElementById("language-submenu"),a=document.getElementById("language-submenu-arrow");t&&n&&a&&t.addEventListener("click",e=>{e.preventDefault(),"true"===t.getAttribute("aria-expanded")?(n.classList.add("hidden"),t.setAttribute("aria-expanded","false"),a.style.transform="rotate(0deg)"):(n.classList.remove("hidden"),t.setAttribute("aria-expanded","true"),a.style.transform="rotate(90deg)")}),document.addEventListener("click",e=>{(e.target.matches("[data-modal-toggle]")||e.target.closest("[data-modal-toggle]"))&&setTimeout(()=>{this.applyTranslations()},100)}),new MutationObserver(e=>{let t=!1;e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.matches("[data-translate]")||e.querySelector("[data-translate]"))&&(t=!0)})}),t&&setTimeout(()=>this.applyTranslations(),50)}).observe(document.body,{childList:!0,subtree:!0})}refreshTranslations(e=document){e.querySelectorAll("[data-translate]").forEach(e=>{var t=e.getAttribute("data-translate"),n=e.getAttribute("data-original-text")||e.textContent;e.getAttribute("data-original-text")||e.setAttribute("data-original-text",n);let a=this.translate(t,n);a.includes("{}")&&(t=n.match(/Explore (\w+) topics/))&&(a=a.replace("{}",t[1].toLowerCase())),e.textContent=a})}getLanguageInfo(){return{code:this.currentLanguage,name:{en:"English",hu:"Magyar",vi:"Tiếng Việt"}[this.currentLanguage]||this.currentLanguage}}}function t(e,t=null){return window.languageManager?window.languageManager.translate(e,t):t||e}document.addEventListener("DOMContentLoaded",()=>{window.languageManager=new LanguageManager});let questions=[],totalQuestions=0,currentQuestionIndex=0,selectedAnswers=[],correctAnswers=0,wrongAnswers=[],quizStartTime=new Date,remainingSeconds=0,totalTimeSeconds=0,timerInterval,quizResults={},isTimerPaused=!1,pausedTime=0;function initializeQuizData(e){questions=e||[],totalQuestions=questions.length,totalTimeSeconds=10*totalQuestions,quizResults={totalQuestions:totalQuestions,correctAnswers:0,wrongAnswers:[],completedAt:null}}function setupEventListeners(){var e=document.getElementById("actionBtn"),e=(e&&e.addEventListener("click",handleActionButton),document.getElementById("timerControl")),t=document.getElementById("timerIcon");let r=document.querySelector(".w-24.h-24");e&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),toggleTimer()}),t&&t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),toggleTimer()}),r&&r.addEventListener("click",function(e){var t=r.getBoundingClientRect(),n=t.left+t.width/2,t=t.top+t.height/2,a=e.clientX,e=e.clientY;Math.sqrt(Math.pow(a-n,2)+Math.pow(e-t,2))<=20&&toggleTimer()});var e=document.getElementById("finishQuizBtn"),t=(e&&e.addEventListener("click",finishQuiz),document.getElementById("close-explanation-modal")),e=document.getElementById("close-explanation-modal-footer"),n=document.getElementById("continue-quiz-btn");t&&t.addEventListener("click",function(e){e.preventDefault(),hideExplanationModal()}),e&&e.addEventListener("click",function(e){e.preventDefault(),hideExplanationModal()}),n&&n.addEventListener("click",function(e){e.preventDefault(),hideExplanationModal(),(currentQuestionIndex<questions.length-1?nextQuestion:showEvaluation)()})}function loadQuestion(e){if(e>=questions.length)showEvaluation();else{hideExplanationModal();var t=questions[e],n=(currentQuestionIndex=e,document.getElementById("currentQuestionNum")),r=document.getElementById("totalQuestions"),n=(n&&(n.textContent=e+1),r&&(r.textContent=totalQuestions),updateQuestionProgress(),document.getElementById("questionText"));n&&(n.textContent=t.question,n.removeAttribute("data-translate"));let a=document.getElementById("optionsContainer");a.innerHTML="",t.options.forEach((e,t)=>{var n=document.createElement("div");n.className="option-card cursor-pointer p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200",n.setAttribute("data-option-index",t),n.innerHTML=`
            <div class="flex items-center">
                <input type="radio" name="answer" value="${t}" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                <label class="ml-3 text-gray-900 dark:text-white font-medium cursor-pointer">${e}</label>
            </div>
        `,n.addEventListener("click",function(){selectOption(t)}),n.style.pointerEvents="auto",a.appendChild(n)});e=document.getElementById("actionBtn"),r=(e&&(e.className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800",e.dataset.mode="submit"),document.getElementById("bottom-banner"));r&&r.classList.add("hidden")}}function selectOption(e){document.querySelectorAll(".option-card").forEach(e=>{e.classList.remove("bg-blue-100","dark:bg-blue-900","border-blue-500"),e.classList.add("border-gray-300","dark:border-gray-600")});e=document.querySelector(`[data-option-index="${e}"]`);e.classList.remove("border-gray-300","dark:border-gray-600"),e.classList.add("bg-blue-100","dark:bg-blue-900","border-blue-500"),e.querySelector('input[type="radio"]').checked=!0}function submitAnswer(){var e=document.querySelector('input[name="answer"]:checked');if(e){let r=parseInt(e.value);e=questions[currentQuestionIndex];let i=e.correct_answer;selectedAnswers[currentQuestionIndex]=r,document.querySelectorAll(".option-card").forEach((e,t)=>{var n,a=t===r,t=t===i;e.classList.remove("bg-blue-100","dark:bg-blue-900","border-blue-500","border-gray-300","dark:border-gray-600","bg-green-100","dark:bg-green-900","border-green-500","bg-red-100","dark:bg-red-900","border-red-500"),t?(e.classList.add("bg-green-100","dark:bg-green-900","border-green-500","border-2"),(t=e.querySelector("label"))&&!t.querySelector(".correct-icon")&&((n=document.createElement("span")).className="correct-icon ml-2 text-green-600 dark:text-green-400",n.innerHTML="✓",t.appendChild(n))):a?(e.classList.add("bg-red-100","dark:bg-red-900","border-red-500","border-2"),(t=e.querySelector("label"))&&!t.querySelector(".wrong-icon")&&((n=document.createElement("span")).className="wrong-icon ml-2 text-red-600 dark:text-red-400",n.innerHTML="✗",t.appendChild(n))):e.classList.add("border-gray-300","dark:border-gray-600"),e.style.pointerEvents="none"}),r===i?(correctAnswers++,quizResults.correctAnswers++):(wrongAnswers.push({questionIndex:currentQuestionIndex,question:e,selectedAnswer:r,correctAnswer:i}),quizResults.wrongAnswers.push({questionIndex:currentQuestionIndex,question:e,selectedAnswer:r,correctAnswer:i})),r!==i&&showExplanationModal(e.explanation);var t,e=document.getElementById("actionBtn");e&&(currentQuestionIndex<questions.length-1?(e.innerHTML='<span data-translate="quiz.next">Next</span>',e.className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors duration-200 focus:ring-4 focus:ring-green-300 dark:focus:ring-green-800",e.dataset.mode="next",window.languageManager&&(t=e.querySelector("span"))&&(t.textContent=window.languageManager.translate("quiz.next"))):(e.innerHTML='<span data-translate="quiz.finish">Finish Quiz</span>',e.className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors duration-200 focus:ring-4 focus:ring-purple-300 dark:focus:ring-purple-800",e.dataset.mode="evaluate",window.languageManager&&(t=e.querySelector("span"))&&(t.textContent=window.languageManager.translate("quiz.finish"))))}else alert("Please select an answer before submitting.")}function handleActionButton(){var e=document.getElementById("actionBtn").dataset.mode;"submit"===e?submitAnswer():"next"===e?nextQuestion():"evaluate"===e&&showEvaluation()}function nextQuestion(){hideExplanationModal(),loadQuestion(currentQuestionIndex+1)}function showExplanationModal(e){var t=document.getElementById("explanation-modal"),n=document.getElementById("modal-explanation-text");t&&n&&(n.innerHTML="",n.removeAttribute("data-translate"),e&&e.trim()?n.textContent=e:window.languageManager?n.textContent=window.languageManager.translate("quiz.no_explanation")||"No explanation available for this question.":n.innerHTML='<span data-translate="quiz.no_explanation">No explanation available for this question.</span>',t.classList.remove("hidden"),t.classList.add("flex"),t.setAttribute("aria-hidden","false"),document.body.classList.add("overflow-hidden"))}function hideExplanationModal(){var e=document.getElementById("explanation-modal");e&&!e.classList.contains("hidden")&&(e.classList.add("hidden"),e.classList.remove("flex"),e.setAttribute("aria-hidden","true"),document.body.classList.remove("overflow-hidden"))}function showEvaluation(){stopTimer(),hideExplanationModal(),quizResults.completedAt=new Date;var e=Math.round(correctAnswers/totalQuestions*100);document.getElementById("questionContainer").classList.add("hidden"),document.getElementById("resultsContainer").classList.remove("hidden"),document.getElementById("scorePercentage").textContent=e+"%",document.getElementById("correctAnswers").textContent=correctAnswers,document.getElementById("totalQuestionsResult").textContent=totalQuestions,0<wrongAnswers.length?displayWrongAnswers():document.getElementById("wrongAnswersSection").classList.add("hidden")}function displayWrongAnswers(){let n=document.getElementById("wrongAnswersList");n.innerHTML="",wrongAnswers.forEach(e=>{var t=document.createElement("div");t.className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm p-6",t.innerHTML=`
            <div class="mb-4">
                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                    ${window.languageManager?window.languageManager.translate("quiz.question_label"):"Question"} ${e.questionIndex+1}:
                </h4>
                <p class="text-gray-700 dark:text-gray-300">${e.question.question}</p>
            </div>
            
            <div class="space-y-3">
                <div class="flex items-start space-x-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">
                        ${window.languageManager?window.languageManager.translate("quiz.your_answer"):"Your Answer"}
                    </span>
                    <span class="text-gray-700 dark:text-gray-300">${e.question.options[e.selectedAnswer]}</span>
                </div>
                
                <div class="flex items-start space-x-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">
                        ${window.languageManager?window.languageManager.translate("quiz.correct_answer"):"Correct Answer"}
                    </span>
                    <span class="text-gray-700 dark:text-gray-300">${e.question.options[e.correctAnswer]}</span>
                </div>
                
                ${e.question.explanation?`
                <div class="pt-3 border-t border-gray-200 dark:border-gray-700">
                    <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-1">${window.languageManager?window.languageManager.translate("quiz.explanation"):"Explanation:"}</h5>
                    <p class="text-sm text-gray-600 dark:text-gray-400">${e.question.explanation}</p>
                </div>
                `:""}
            </div>
        `,n.appendChild(t)})}function initializeTimer(){remainingSeconds=totalTimeSeconds,isTimerPaused=!1,pausedTime=0;var e=document.getElementById("timerDisplay"),t=document.getElementById("timerProgressCircle");e&&t&&(updateTimerDisplay(),startTimer())}function startTimer(){timerInterval||isTimerPaused||(timerInterval=setInterval(()=>{remainingSeconds--,updateTimerDisplay(),remainingSeconds<=0&&(stopTimer(),showEvaluation())},1e3))}function updateTimerDisplay(){var e,t=Math.floor(remainingSeconds/60),n=remainingSeconds%60,t=t.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0"),n=document.getElementById("timerDisplay"),a=document.getElementById("timerProgressCircle");n&&(n.textContent=t),a&&(n=remainingSeconds/totalTimeSeconds*100,e=(t=2*Math.PI*15.9155)-n/100*t,a.style.strokeDasharray=t+" "+t,a.style.strokeDashoffset=e,a.style.stroke=n<20?"#EF4444":n<50?"#F59E0B":"#3B82F6")}function updateQuestionProgress(){var e,t,n=document.getElementById("questionProgressCircle");n&&0<totalQuestions&&(t=(currentQuestionIndex+1)/totalQuestions*100,t=(e=2*Math.PI*15.9155)-t/100*e,n.style.strokeDasharray=e+" "+e,n.style.strokeDashoffset=t)}function stopTimer(){timerInterval&&(clearInterval(timerInterval),timerInterval=null)}function finishQuiz(){fetch("/quiz/submit-results",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(quizResults)}).then(e=>e.json()).then(e=>{window.location.href="/quiz/categories"}).catch(e=>{window.location.href="/quiz/categories"})}function toggleTimer(){var e=document.getElementById("timerIcon");e&&(isTimerPaused?(isTimerPaused=!1,timerInterval=timerInterval||setInterval(()=>{remainingSeconds--,updateTimerDisplay(),remainingSeconds<=0&&(stopTimer(),showEvaluation())},1e3),e.innerHTML='<rect x="0.5" y="0.5" width="0.8" height="2" fill="#3B82F6"/><rect x="1.7" y="0.5" width="0.8" height="2" fill="#3B82F6"/>'):(isTimerPaused=!0,timerInterval&&(clearInterval(timerInterval),timerInterval=null),e.innerHTML='<polygon points="0.5,0.5 0.5,2.5 2.5,1.5" fill="#3B82F6"/>'))}function updateTimeEstimator(e,t){var n,a=document.getElementById("time-display-"+e),r=document.getElementById("progressCircle-"+e);document.querySelectorAll('[id*="time-display"]'),document.querySelectorAll('[id*="progress-circle"]');a&&(n=Math.round(10*t/60*10)/10,a.textContent=n.toFixed(1),r)&&((a=document.querySelector(`[id="questions-range-${e}"]`))?(n=parseInt(a.max),e=parseInt(t),a=Math.round(e/n*100),Math.round(a/100*50),setProgress(r,a)):setProgress(r,100))}function setProgress(e,t){var n;e&&(n=e.r.baseVal.value,n=2*Math.PI*n,e.style.strokeDasharray=n+" "+n,e.style.strokeDashoffset=n-t/100*n)}function updateQuestionCount(e,t){e=document.getElementById("question-count-"+e);e&&(e.textContent=t)}function startQuiz(e,n,t,a){var r=n.replace(/[^a-zA-Z0-9]/g,"-"),i=document.getElementById("quiz-modal-"+r);if(i){i=i.querySelector(".difficulty-btn.active-difficulty");let e=i?i.getAttribute("data-difficulty"):"mixed";i=document.getElementById("questions-range-"+r);let t=i?i.value:10;submitQuizForm(n,e,t)}else void submitQuizForm(n,"mixed",10)}function submitQuizForm(e,t,n){var a=document.createElement("form"),e=(a.method="POST",a.action="/quiz/start/"+encodeURIComponent(e),document.createElement("input")),n=(e.type="hidden",e.name="questionCount",e.value=n,a.appendChild(e),document.createElement("input"));n.type="hidden",n.name="difficulty",n.value=t,a.appendChild(n),document.body.appendChild(a),a.submit()}document.addEventListener("DOMContentLoaded",function(){function n(){var e;window.quizQuestionsData&&0<window.quizQuestionsData.length?(initializeQuizData(window.quizQuestionsData),0<questions.length?(loadQuestion(0),initializeTimer()):((e=document.getElementById("questionText")).removeAttribute("data-translate"),window.languageManager?e.textContent=window.languageManager.translate("quiz.error")||"No questions available for this quiz.":e.textContent="No questions available for this quiz.")):((e=document.getElementById("questionText")).removeAttribute("data-translate"),window.languageManager?e.textContent=window.languageManager.translate("quiz.error")||"Error loading quiz data.":e.textContent="Error loading quiz data."),setupEventListeners()}if(window.languageManager&&window.languageManager.currentLanguage)n();else{let e=0,t=()=>{e++,(!window.languageManager||!window.languageManager.currentLanguage)&&e<50?setTimeout(t,100):n()};setTimeout(t,100)}}),window.toggleTimer=toggleTimer,window.addEventListener("beforeunload",function(){stopTimer()}),window.updateTimeEstimator=updateTimeEstimator,document.addEventListener("click",function(e){var t=e.target.closest(".start-quiz-btn"),n=(t&&(e.preventDefault(),n=t.getAttribute("data-quiz-id"),startQuiz(t.getAttribute("data-quiz-title"),n,t.getAttribute("data-category"),t.getAttribute("data-topic"))),e.target.closest(".cancel-quiz-btn")),t=(n&&(e.preventDefault(),t=n.getAttribute("data-modal-hide"),n=document.getElementById(t))&&(document.activeElement.blur(),n.classList.add("hidden"),n.setAttribute("aria-hidden","true"),n.removeAttribute("tabindex"),document.body.classList.remove("overflow-hidden")),e.target.closest(".difficulty-btn"));t&&(e.preventDefault(),t.parentElement.querySelectorAll(".difficulty-btn").forEach(e=>{e.classList.remove("active-difficulty");var t=e.getAttribute("data-difficulty");"easy"===t?e.className="difficulty-btn flex items-center justify-center px-4 py-3 text-sm font-medium transition-all duration-200 bg-green-50 text-green-700 border border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/40 focus:z-10 focus:ring-2 focus:ring-green-500 data-[active=true]:bg-green-600 data-[active=true]:text-white data-[active=true]:border-green-600":"medium"===t?e.className="difficulty-btn flex items-center justify-center px-4 py-3 text-sm font-medium transition-all duration-200 bg-yellow-50 text-yellow-700 border border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-800 hover:bg-yellow-100 dark:hover:bg-yellow-900/40 focus:z-10 focus:ring-2 focus:ring-yellow-500 data-[active=true]:bg-yellow-600 data-[active=true]:text-white data-[active=true]:border-yellow-600":"hard"===t?e.className="difficulty-btn flex items-center justify-center px-4 py-3 text-sm font-medium transition-all duration-200 bg-red-50 text-red-700 border border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/40 focus:z-10 focus:ring-2 focus:ring-red-500 data-[active=true]:bg-red-600 data-[active=true]:text-white data-[active=true]:border-red-600":"mixed"===t&&(e.className="difficulty-btn flex items-center justify-center px-4 py-3 text-sm font-medium transition-all duration-200 bg-blue-600 text-white border border-blue-600 hover:bg-blue-700 hover:border-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-500")}),t.classList.add("active-difficulty"),"easy"===(n=t.getAttribute("data-difficulty"))?(t.classList.remove("bg-green-50","text-green-700","border-green-200"),t.classList.add("bg-green-600","text-white","border-green-600")):"medium"===n?(t.classList.remove("bg-yellow-50","text-yellow-700","border-yellow-200"),t.classList.add("bg-yellow-600","text-white","border-yellow-600")):"hard"===n&&(t.classList.remove("bg-red-50","text-red-700","border-red-200"),t.classList.add("bg-red-600","text-white","border-red-600")))}),document.addEventListener("input",function(e){var t;"range"===e.target.type&&(updateQuestionCount(t=e.target.getAttribute("data-quiz-id"),e=e.target.value),updateTimeEstimator(t,e))}),document.addEventListener("change",function(e){var t;e.target.classList.contains("questions-range-slider")&&(updateQuestionCount(t=e.target.getAttribute("data-quiz-id"),e=e.target.value),updateTimeEstimator(t,e))}),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".questions-range-slider").forEach(e=>{var t=e.getAttribute("data-quiz-id"),e=e.value;updateQuestionCount(t,e),updateTimeEstimator(t,e)})});